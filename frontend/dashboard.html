<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>GSA — Dashboard</title>
  <link rel="stylesheet" href="style.css"/>
  <script src="app.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <div class="logo">IMS</div>
        <div>
          <div style="font-weight:700">Dashboard</div>
          <div class="small" id="welcomeSub"></div>
        </div>
      </div>
      <div class="nav">
        <a class="link" href="index.html">Home</a>
        <a class="link" href="stock.html">Stock</a>
        <a class="link" href="cart.html">Cart</a>
        <a id="authLink" class="link" href="login.html">Login</a>
      </div>
    </div>

    <div class="grid cols-3" style="margin-bottom:12px">
      <div class="card kpi">
        <div class="small">Total items (types)</div>
        <div id="totalTypes" style="font-size:20px;font-weight:700"></div>
      </div>
      <div class="card kpi">
        <div class="small">Total quantity in stock</div>
        <div id="totalQty" style="font-size:20px;font-weight:700"></div>
      </div>
      <div class="card kpi">
        <div class="small">Cart items</div>
        <div id="cartCount" style="font-size:20px;font-weight:700"></div>
      </div>
    </div>

    <div class="card">
      <h3>Stock snapshot</h3>
      <table class="table" id="tblStock">
        <thead><tr><th>Name</th><th>SKU</th><th>Qty</th><th>Price</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div style="height:20px"></div>
    <div class="footer">Dashboard • GSA</div>
  </div>

<script>
IMS.requireAuth('login.html'); // optional redirect to login if not logged
const user = IMS.currentUser();
document.getElementById('welcomeSub').innerText = user? `Hello, ${user.name}` : 'Guest';
document.getElementById('authLink').innerText = user? 'Logout' : 'Login';
if(user){
  document.getElementById('authLink').href = '#';
  document.getElementById('authLink').addEventListener('click', (e)=>{
    e.preventDefault(); IMS.logout(); window.location.href='login.html';
  });
}

function render() {
  const items = IMS.getItems();
  const cart = IMS.getCart();
  document.getElementById('totalTypes').innerText = items.length;
  document.getElementById('totalQty').innerText = items.reduce((s,i)=>s+i.qty,0);
  document.getElementById('cartCount').innerText = cart.length;
  const tbody = document.querySelector('#tblStock tbody');
  tbody.innerHTML = '';
  items.forEach(it=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${it.name}</td><td class="small">${it.sku}</td><td>${it.qty}</td><td>₹ ${it.price}</td>`;
    tbody.appendChild(tr);
  });
}
render();
</script>
</body>
</html>
