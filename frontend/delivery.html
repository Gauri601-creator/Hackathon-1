<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GSA â€” Deliveries</title>

  <link rel="stylesheet" href="style.css">

  <style>
    :root {
      --primary: #2b59ff;
      --card-bg: #1f2235;
      --border-light: rgba(255,255,255,0.08);
      --table-head: #2d3250;
      --text-light: #ddd;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #11131f;
      color: white;
    }

    /* SIDEBAR */
    .sidebar {
      width:230px;
      background:#0d0f1a;
      color:white;
      height:100vh;
      padding:20px;
      position:fixed;
      left:0; top:0;
      border-right:1px solid rgba(255,255,255,0.06);
    }
    .sidebar h2 {
      margin-bottom:25px;
      font-size:20px;
      letter-spacing:1px;
    }
    .sb-link {
      display:block;
      padding:10px 12px;
      border-radius:8px;
      margin-bottom:6px;
      color:#bbb;
      text-decoration:none;
      transition:0.2s;
    }
    .sb-link:hover, .active {
      background:var(--primary);
      color:white;
    }

    /* MAIN */
    .main {
      margin-left:260px;
      padding:20px;
    }

    .card {
      background:var(--card-bg);
      border-radius:12px;
      padding:18px;
      box-shadow:0 2px 12px rgba(0,0,0,0.3);
      margin-bottom:20px;
    }

    table {
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
      color:white;
    }
    th, td {
      padding:12px;
      border-bottom:1px solid var(--border-light);
      font-size:14px;
    }
    th {
      background:var(--table-head);
      font-weight:600;
    }

    /* BUTTONS */
    .btn {
      background:var(--primary);
      color:white;
      padding:8px 14px;
      border-radius:8px;
      cursor:pointer;
      border:none;
      transition:0.2s;
    }
    .btn:hover {
      background:#1f45d4;
    }
    .btn.red {
      background:#e74c3c;
    }
  </style>
</head>
<body>

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h2>IMS</h2>
    <a class="sb-link" href="dashboard.html">Dashboard</a>
    <a class="sb-link" href="inventory.html">Inventory</a>
    <a class="sb-link" href="cart.html">Cart</a>
    <a class="sb-link active" href="deliveries.html">Deliveries</a>
    <a class="sb-link" href="reports.html">Reports</a>
  </div>

  <!-- MAIN -->
  <div class="main">
    <h1>Deliveries</h1>

    <!-- PENDING DELIVERIES -->
    <div class="card">
      <h3>Pending Deliveries</h3>
      <table id="pendingTable">
        <thead>
          <tr>
            <th>Item</th>
            <th>Qty</th>
            <th>Date Added</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- COMPLETED DELIVERIES -->
    <div class="card">
      <h3>Completed Deliveries</h3>
      <table id="completedTable">
        <thead>
          <tr>
            <th>Item</th>
            <th>Qty</th>
            <th>Delivered On</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

  </div>

<script>
let inventory = JSON.parse(localStorage.getItem("IMS_inventory") || "[]");
let pending = JSON.parse(localStorage.getItem("IMS_pendingDeliveries") || "[]");
let done = JSON.parse(localStorage.getItem("IMS_completedDeliveries") || "[]");
let sales = JSON.parse(localStorage.getItem("IMS_sales") || "[]");

/* RENDER PENDING */
function renderPending() {
  const tbody = document.querySelector("#pendingTable tbody");
  tbody.innerHTML = "";

  if (pending.length === 0) {
    tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;color:#888">No pending deliveries</td></tr>`;
    return;
  }

  pending.forEach((d, index) => {
    tbody.innerHTML += `
      <tr>
        <td>${d.name}</td>
        <td>${d.qty}</td>
        <td>${d.date}</td>
        <td>
          <button class="btn" onclick="deliver(${index})">Mark Delivered</button>
        </td>
      </tr>`;
  });
}

/* RENDER COMPLETED */
function renderDone() {
  const tbody = document.querySelector("#completedTable tbody");
  tbody.innerHTML = "";

  if (done.length === 0) {
    tbody.innerHTML = `<tr><td colspan="3" style="text-align:center;color:#888">No deliveries completed yet</td></tr>`;
    return;
  }

  done.forEach(d => {
    tbody.innerHTML += `
      <tr>
        <td>${d.name}</td>
        <td>${d.qty}</td>
        <td>${d.date}</td>
      </tr>`;
  });
}

/* MARK AS DELIVERED */
function deliver(i) {
  const item = pending[i];

  // reduce inventory
  let invItem = inventory.find(x => x.name === item.name);
  if (invItem) {
    invItem.qty -= item.qty;
    if (invItem.qty < 0) invItem.qty = 0;
  }

  // add to completed list
  let deliveredInfo = {
    name: item.name,
    qty: item.qty,
    date: new Date().toLocaleString()
  };
  done.push(deliveredInfo);

  // save SALE entry
  sales.push({
    name: item.name,
    qty: item.qty,
    category: invItem?.category || "Unknown",
    date: new Date().toLocaleString()
  });

  // remove from pending
  pending.splice(i, 1);

  // SAVE back to storage
  localStorage.setItem("IMS_inventory", JSON.stringify(inventory));
  localStorage.setItem("IMS_pendingDeliveries", JSON.stringify(pending));
  localStorage.setItem("IMS_completedDeliveries", JSON.stringify(done));
  localStorage.setItem("IMS_sales", JSON.stringify(sales));

  renderPending();
  renderDone();
}

renderPending();
renderDone();
</script>

</body>
</html>
