<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>GSA — Login</title>
  <link rel="stylesheet" href="style.css"/>
  <script src="app.js"></script>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <div class="logo">GSA</div>
        <div>
          <div style="font-weight:700">STOCKCLOUD</div>
          <div class="small">Secure Login with OTP</div>
        </div>
      </div>
      <div class="nav">
        <a class="link" href="index.html">Home</a>
      </div>
    </div>

    <!-- LOGIN CARD -->
    <div class="card" style="max-width:520px;margin:0 auto" id="loginCard">
      <h2>Sign in</h2>
      <p class="small">Use <strong>admin / admin</strong> to login.</p>

      <div class="form">
        <input id="u" placeholder="username" />
        <input id="p" placeholder="password" type="password"/>

        <button id="btnStartAuth" class="btn" style="margin-top:10px;">Continue</button>

        <div id="msg" class="small" style="margin-top:8px;color:var(--danger)"></div>
      </div>
    </div>

    <!-- OTP CARD -->
    <div class="card" style="max-width:520px;margin:0 auto; display:none;" id="otpCard">
      <h2>OTP Verification</h2>
      <p class="small">An OTP has been sent to the registered email.</p>

      <div class="form">
        <input id="otpInput" placeholder="Enter 4-digit OTP" maxlength="4"/>

        <button id="btnVerifyOtp" class="btn" style="margin-top:10px;">Verify OTP</button>
        <button id="btnResendOtp" class="btn ghost" style="margin-top:10px;">Resend OTP</button>

        <div id="otpMsg" class="small" style="margin-top:8px;color:var(--danger)"></div>
      </div>
    </div>

    <div class="footer">Made with BY GSA</div>
  </div>

<script>
let generatedOTP = null;
let currentUser = null;

// STEP 1 → Validate username/password
document.getElementById("btnStartAuth").addEventListener("click", () => {
  const u = document.getElementById('u').value.trim();
  const p = document.getElementById('p').value.trim();

  if(!u || !p){
    document.getElementById('msg').innerText = 'Please enter credentials';
    return;
  }

  if(IMS.login(u,p)){ 
    currentUser = u;
    generatedOTP = generateOTP();
    
    alert("Your OTP is: " + generatedOTP);   // simulate email/SMS
    switchToOTP();
  } 
  else {
    document.getElementById('msg').innerText = 'Invalid username or password';
  }
});

// STEP 2 → Verify OTP
document.getElementById("btnVerifyOtp").addEventListener("click", () => {
  const otp = document.getElementById("otpInput").value.trim();

  if(otp === generatedOTP){
    alert("Login Successful!");
    window.location.href = "dashboard.html";
  } else {
    document.getElementById("otpMsg").innerText = "Incorrect OTP. Try again.";
  }
});

// STEP 3 → Resend OTP
document.getElementById("btnResendOtp").addEventListener("click", () => {
  generatedOTP = generateOTP();
  alert("New OTP: " + generatedOTP);
  document.getElementById("otpMsg").innerText = "New OTP sent!";
});

// Generate 4-digit OTP
function generateOTP(){
  return Math.floor(1000 + Math.random() * 9000).toString();
}

// Switch login → OTP screen
function switchToOTP(){
  document.getElementById("loginCard").style.display = "none";
  document.getElementById("otpCard").style.display = "block";
}
</script>

</body>
</html>
