<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GSA â€” Reports</title>
  <link rel="stylesheet" href="style.css">

  <style>
    :root {
      --primary: #2b59ff;
      --card-bg: #1f2235;
      --table-head: #2d3250;
      --border-light: rgba(255,255,255,0.08);
      --text-light: #ddd;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #11131f;
      color: white;
    }

    .page {
      display:flex;
      gap:22px;
      margin-top:25px;
    }

    /* SIDEBAR */
    .sidebar {
      width:230px;
      background:#0d0f1a;
      color:white;
      height:100vh;
      padding:20px;
      position:fixed;
      left:0; top:0;
      border-right:1px solid rgba(255,255,255,0.06);
    }
    .sidebar h2 {
      margin:0 0 25px 0;
      font-size:20px;
      letter-spacing:1px;
    }
    .sb-link {
      display:block;
      padding:10px 12px;
      margin-bottom:6px;
      border-radius:8px;
      color:#bbb;
      text-decoration:none;
      font-size:15px;
      transition:0.2s;
    }
    .sb-link:hover, .active {
      background:var(--primary);
      color:#fff;
    }

    /* MAIN */
    .main {
      margin-left:260px;
      padding:20px;
      width:calc(100% - 260px);
    }

    .card {
      background: var(--card-bg);
      padding:18px;
      border-radius:12px;
      box-shadow:0 2px 12px rgba(0,0,0,0.3);
      margin-bottom:20px;
    }

    table {
      width:100%;
      border-collapse:collapse;
      margin-top:12px;
      color:white;
    }
    th, td {
      padding:12px;
      border-bottom:1px solid var(--border-light);
      font-size:14px;
    }
    th {
      background:var(--table-head);
      font-weight:600;
    }

    .filters {
      display:flex;
      gap:10px;
      margin-bottom:15px;
    }
    .filters input, .filters select {
      padding:10px;
      border-radius:8px;
      border:1px solid #444;
      background:#131522;
      color:white;
      outline:none;
    }

    .btn {
      padding:10px 16px;
      background:var(--primary);
      border:none;
      color:white;
      border-radius:8px;
      cursor:pointer;
      font-size:14px;
      transition:0.2s;
    }
    .btn:hover {
      background:#1f45d4;
    }
  </style>
</head>

<body>

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h2>IMS</h2>
    <a class="sb-link" href="dashboard.html">Dashboard</a>
    <a class="sb-link" href="inventory.html">Inventory</a>
    <a class="sb-link" href="cart.html">Cart</a>
    <a class="sb-link" href="deliveries.html">Deliveries</a>
    <a class="sb-link active" href="reports.html">Reports</a>
  </div>

  <!-- MAIN CONTENT -->
  <div class="main">

    <h1>Reports</h1>

    <!-- Filters -->
    <div class="card">
      <h3>Filters</h3>

      <div class="filters">
        <input type="date" id="fromDate">
        <input type="date" id="toDate">
        <select id="filterCategory">
          <option value="">All Categories</option>
          <option value="Electronics">Electronics</option>
          <option value="Food">Food</option>
          <option value="Clothes">Clothes</option>
        </select>
        <button class="btn" onclick="downloadCSV()">Download CSV</button>
      </div>
    </div>

    <!-- SALES REPORT -->
    <div class="card">
      <h3>Sales Report</h3>
      <table id="salesTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Item</th>
            <th>Category</th>
            <th>Qty Sold</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- LOW STOCK -->
    <div class="card">
      <h3>Low Stock Items</h3>
      <table id="lowStockTable">
        <thead>
          <tr>
            <th>Item</th>
            <th>Category</th>
            <th>Remaining Qty</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- SUMMARY -->
    <div class="card">
      <h3>Category Summary</h3>
      <table id="summaryTable">
        <thead>
          <tr>
            <th>Category</th>
            <th>Total Items</th>
            <th>Total Stock</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

  </div>

<script>
let inventory = JSON.parse(localStorage.getItem("IMS_inventory") || "[]");
let sales = JSON.parse(localStorage.getItem("IMS_sales") || "[]");

/* Render All */
function renderReports() {
  renderSalesReport();
  renderLowStock();
  renderCategorySummary();
}

/* SALES REPORT */
function renderSalesReport() {
  const tbody = document.querySelector("#salesTable tbody");
  tbody.innerHTML = "";

  sales.forEach(s => {
    tbody.innerHTML += `
      <tr>
        <td>${s.date}</td>
        <td>${s.name}</td>
        <td>${s.category}</td>
        <td>${s.qty}</td>
      </tr>`;
  });
}

/* LOW STOCK */
function renderLowStock() {
  const tbody = document.querySelector("#lowStockTable tbody");
  tbody.innerHTML = "";

  inventory
    .filter(i => i.qty <= 5)
    .forEach(i => {
      tbody.innerHTML += `
        <tr>
          <td>${i.name}</td>
          <td>${i.category}</td>
          <td>${i.qty}</td>
        </tr>`;
    });
}

/* CATEGORY SUMMARY */
function renderCategorySummary() {
  const tbody = document.querySelector("#summaryTable tbody");
  tbody.innerHTML = "";

  let categories = {};

  inventory.forEach(i => {
    if (!categories[i.category]) {
      categories[i.category] = { items: 0, qty: 0 };
    }
    categories[i.category].items++;
    categories[i.category].qty += i.qty;
  });

  Object.keys(categories).forEach(cat => {
    const c = categories[cat];
    tbody.innerHTML += `
      <tr>
        <td>${cat}</td>
        <td>${c.items}</td>
        <td>${c.qty}</td>
      </tr>`;
  });
}

/* DOWNLOAD CSV */
function downloadCSV() {
  let csv = "Date,Item,Category,Qty Sold\n";

  sales.forEach(s => {
    csv += `${s.date},${s.name},${s.category},${s.qty}\n`;
  });

  let file = new Blob([csv], { type: "text/csv" });
  let a = document.createElement("a");
  a.href = URL.createObjectURL(file);
  a.download = "sales_report.csv";
  a.click();
}

renderReports();
</script>

</body>
</html>
